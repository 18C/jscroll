/**
 * jScroll jQuery Plugin v1.0
 * http://jscroll.com/
 * 
 * Copyright 2011, Philip Klauzinski
 * http://klauzinski.com/
 * Dual licensed under the MIT and GPL Version 2 licenses.
 * http://jscroll.com/#license
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl-2.0.html
 * 
 * @author Philip Klauzinski
 * @version 1.0
 * @requires jQuery v1.4.3+
 */
(function(b){b.jscroll={defaults:{debug:false,autoTrigger:true,loadingHtml:"<small>Loading...</small>",padding:0,nextSelector:"a:last",contentSelector:""}};var a=function(c,n){var i,d=c.data("jscroll"),h=(typeof n==="function")?{callback:n}:n;_options=b.extend({},b.jscroll.defaults,h,d||{}),_$next=c.find(_options.nextSelector).first();(function(){i=this;c.data("jscroll",b.extend({},d,{initialized:true,waiting:false,nextHref:_$next.attr("href")}));c.contents().wrapAll('<div class="jscroll-inner" />');m();if(_options.autoTrigger){g(_$next);c.bind("scroll.jscroll",function(){return f()})}else{_$next.bind("click.jscroll",function(){g(_$next);j();return false})}})();function m(){var p=b(_options.loadingHtml).filter("img").attr("src");if(p){var o=new Image();o.src=p}}function g(o){var p=o.parent().not(".jscroll-inner").addClass("jscroll-next-parent").hide();if(!p.length){o.wrap('<div class="jscroll-next-parent" />').parent().hide()}}function k(){return c.unbind(".jscroll").removeData("jscroll").find(".jscroll-inner").children().unwrap().filter(".jscroll-added").children().unwrap()}function f(){var s=c.find("div.jscroll-inner").first(),r=c.data("jscroll"),p=parseInt(c.css("paddingTop"))+parseInt(c.css("borderTopWidth")),o=Math.ceil(c.offset().top-s.offset().top+c.height()+p),q=b.trim(r.nextHref+" "+_options.contentSelector);if(l(r)&&!r.waiting&&o+_options.padding>=s.outerHeight()){e("info","jScroll:",s.outerHeight()-o,"from bottom. Loading next request...");return j()}}function l(o){o=o||c.data("jscroll");if(!o.nextHref){e("warn","jScroll: nextSelector not found - destroying");c.jscroll.destroy();return false}else{return true}}function j(){var p=c.find("div.jscroll-inner").first(),o=c.data("jscroll");o.waiting=true;p.append('<div class="jscroll-added" />').children(".jscroll-added").last().html('<div class="jscroll-loading">'+_options.loadingHtml+"</div>");return l(o)&&c.animate({scrollTop:p.outerHeight()},500,function(){p.find("div.jscroll-added").last().load(o.nextHref,function(t,s,u){var q=b(this).find(_options.nextSelector).first();o.waiting=false;o.nextHref=q.attr("href");b(".jscroll-next-parent",c).remove();if(_options.autoTrigger){g(q)}else{q.bind("click.jscroll",function(){g(q);f();return false})}e("dir",o)})})}function e(o){if(_options.debug&&typeof console==="object"&&(typeof o==="object"||typeof console[o]==="function")){if(typeof o==="object"){var q=[];for(var p in o){if(typeof console[p]==="function"){q=(o[p].length)?o[p]:[o[p]];console[p].apply(console,q)}else{console.log.apply(console,q)}}}else{console[o].apply(console,Array.prototype.slice.call(arguments,1))}}}b.extend(c.jscroll,{destroy:k});return c};b.fn.jscroll=function(c){return this.each(function(){var f=b(this),e=f.data("jscroll");if(e&&e.initialized){return}var d=new a(f,c)})}})(jQuery);